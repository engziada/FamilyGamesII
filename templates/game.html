{% extends "base.html" %}

{% block content %}
<div class="game-container">
    <!-- Hidden inputs for game data -->
    <input type="hidden" id="game-id" value="{{ game_id }}">
    <input type="hidden" id="player-name" value="{{ player_name }}">
    <input type="hidden" id="transfer-id" value="{{ transfer_id }}">
    <input type="hidden" id="is-host" value="{{ 'true' if is_host else 'false' }}">

    <div class="game-board">
        <div class="status-bar">
            <div class="turn-indicator">
                <span id="current-turn-avatar" class="player-avatar"></span>
                ุงูุฏูุฑ ุนูู: <span id="current-turn">...</span>
            </div>
            <div id="timer" class="timer-container">
                <svg class="timer-svg" viewBox="0 0 100 100">
                    <circle class="timer-bg" cx="50" cy="50" r="45"></circle>
                    <circle id="timer-progress" class="timer-progress" cx="50" cy="50" r="45"></circle>
                </svg>
                <div class="timer-text">
                    <span id="timer-val">02:00</span>
                </div>
            </div>
        </div>

        <div id="skip-countdown" class="u-hidden" style="background: var(--danger); color: white; padding: 0.5rem 1rem; border-radius: 50px; font-weight: 800; box-shadow: var(--shadow-pop); margin-bottom: 1rem; text-align: center;">
            ุณูุชู ุชุฎุทูู ุฎูุงู <span id="skip-timer-val">30</span>ุซ!
        </div>
        
        <div class="display-area card">
            <div id="item-display" class="item-card animate-jelly u-hidden u-full-width">
                <!-- Content populated by JS -->
            </div>

            <!-- Pictionary Canvas -->
            <div id="pictionary-area" class="u-hidden u-full-width" style="position: relative;">
                <div class="canvas-controls u-flex-center u-margin-bottom">
                    <button class="btn btn-outline" onclick="window.gameInstance.clearCanvas()" id="clear-btn" style="padding: 0.8rem 1.2rem;"><i class="fas fa-eraser"></i> ูุณุญ</button>
                    <input type="color" id="draw-color" value="#FF6B6B" style="width: 50px; height: 50px; border: 3px solid var(--text); border-radius: 15px; cursor: pointer; padding: 0;">
                    <input type="range" id="draw-size" min="1" max="20" value="5" class="input-control" style="width: 120px; min-height: auto; padding: 0.5rem;">
                </div>
                <canvas id="game-canvas" width="600" height="400" style="border: 4px solid var(--text); border-radius: 20px 60px; background: white; cursor: crosshair; width: 100%; height: auto; touch-action: none; box-shadow: var(--shadow-pop);"></canvas>
                <div id="hints-container" class="u-flex-center u-margin-top" style="flex-wrap: wrap; gap: 10px;">
                    <!-- Hints populated by JS -->
                </div>
            </div>

            <div id="waiting-area" class="waiting-area u-text-center">
                <i class="fas fa-hourglass-start fa-3x animate-heartbeat" style="color: var(--secondary); margin-bottom: 2rem;"></i>
                <h3>ูู ุงูุชุธุงุฑ ุจุฏุก ุงูุฌููุฉ...</h3>
            </div>

            <div class="game-actions u-flex-center u-full-width u-margin-top">
                <button id="readyButton" class="btn btn-primary u-hidden">
                    <i class="fas fa-play"></i> ุฃูุง ุฌุงูุฒ!
                </button>
                <button id="passButton" class="btn btn-outline u-hidden">
                    <i class="fas fa-forward"></i> ุชุฎุทู
                </button>
                <button id="guessButton" class="btn btn-secondary u-hidden">
                    <i class="fas fa-check"></i> ุนุฑูุชูุง!
                </button>
            </div>
        </div>

        <div class="host-controls card u-flex-center" style="padding: 1.5rem;">
            {% if player_type == 'host' %}
            <button id="startButton" class="btn btn-primary" style="display: none;">
                <i class="fas fa-play-circle"></i> ุงุจุฏุฃ ุงููุนุจุฉ
            </button>
            <button id="nextButton" class="btn btn-secondary" style="display: none;">
                <i class="fas fa-step-forward"></i> ุงูุฌููุฉ ุงูุชุงููุฉ
            </button>
            <button id="finishButton" class="btn btn-primary" style="display: none; background-color: var(--success);">
                <i class="fas fa-flag-checkered"></i> ุฅููุงุก ูุนุฑุถ ุงููุชุงุฆุฌ
            </button>
            <button id="close-room" class="btn btn-outline" style="color: white; background-color: var(--danger);">
                <i class="fas fa-times-circle"></i> ุฅุบูุงู ุงูุบุฑูุฉ
            </button>
            {% else %}
            <button id="leaveButton" class="btn btn-outline">
                <i class="fas fa-sign-out-alt"></i> ุงูุณุญุงุจ
            </button>
            {% endif %}
        </div>
    </div>

    <div class="sidebar">
        <div class="card player-list-card">
            <h4><i class="fas fa-users"></i> ุงููุงุนุจูู</h4>
            <div id="players-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="card score-card">
            <h4><i class="fas fa-trophy"></i> ุงููุชุงุฆุฌ</h4>
            <div id="scores">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="card info-card" style="padding: 1.2rem; font-size: 0.9rem; color: var(--text-light); text-align: center;">
            <button class="btn-help" onclick="Utils.showRules('{{ game_type }}')" style="margin-top: 0; margin-bottom: 1rem;">
                <i class="fas fa-question-circle"></i> ุงูููุงููู
            </button>
            <p>ุฑูู ุงูุบุฑูุฉ: <strong id="game-room-id" style="color: var(--primary);">{{ game_id }}</strong>
                <button class="btn-copy" onclick="Utils.copyToClipboard('game-room-id')" title="ูุณุฎ ุฑูู ุงูุบุฑูุฉ">
                    <i class="fas fa-copy"></i>
                </button>
            </p>
            <p>ุฃูุช ุชูุนุจ ุจุตูุชู: <strong style="color: var(--secondary);">{{ player_name }}</strong></p>
        </div>
    </div>
</div>

<div id="rules-modal" class="modal">
    <div class="modal-content animate-bounce-down" style="max-width: 600px;">
        <h2 id="rules-title">ููู ุชูุนุจุ</h2>
        <div id="rules-content" class="u-text-right u-full-width" style="text-align: right; max-height: 60vh; overflow-y: auto; padding: 1rem; background: var(--bg-main); border-radius: 15px;">
            <!-- Rules populated by JS -->
        </div>
        <div class="buttons u-flex-center u-full-width">
            <button class="btn btn-primary" style="width: 100%;" onclick="Utils.hideModal('rules-modal')">ูููุช!</button>
        </div>
    </div>
</div>

<div id="reaction-bar" class="reaction-bar">
    <button class="reaction-btn" onclick="window.gameInstance.sendReaction('๐')">๐</button>
    <button class="reaction-btn" onclick="window.gameInstance.sendReaction('๐')">๐</button>
    <button class="reaction-btn" onclick="window.gameInstance.sendReaction('๐ฅ')">๐ฅ</button>
    <button class="reaction-btn" onclick="window.gameInstance.sendReaction('โค๏ธ')">โค๏ธ</button>
    <button class="reaction-btn" onclick="window.gameInstance.sendReaction('๐ฎ')">๐ฎ</button>
</div>

<div id="game-status" class="u-hidden">
    <!-- Used for snackbar style notifications -->
</div>

<!-- Summary Modal -->
<div id="summary-modal" class="modal">
    <div class="modal-content animate-bounce-down" style="max-width: 700px; padding: 3rem;">
        <div id="summary-celebration">
            <i class="fas fa-trophy fa-5x" style="color: var(--accent); margin-bottom: 1.5rem;"></i>
            <h1 id="winner-name" style="color: var(--primary); font-size: 2.5rem;">ุจุทู ุงููุนุจุฉ!</h1>
        </div>

        <div id="final-leaderboard" class="u-full-width u-margin-top">
            <!-- Leaderboard items -->
        </div>

        <div id="game-stats" class="stats-grid u-full-width u-margin-top" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <!-- Highlights -->
        </div>

        <div class="buttons u-flex-center u-full-width u-margin-top">
            <button class="btn btn-outline" style="flex: 1;" onclick="window.gameInstance.shareResults()">
                <i class="fas fa-share-alt"></i> ุดุงุฑู ุงููุชูุฌุฉ
            </button>
            <button class="btn btn-primary" style="flex: 1;" onclick="window.location.href='/'">ุงูุฑุฆูุณูุฉ</button>
            <button class="btn btn-secondary" style="flex: 1;" onclick="Utils.hideModal('summary-modal')">ูุดุงูุฏุฉ ุงูุฃูุถุฉ</button>
        </div>
    </div>
</div>


<div id="error-message"></div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/charades.js') }}"></script>
{% endblock %}
