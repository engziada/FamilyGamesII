{% extends "base.html" %}

{% block content %}
<div class="game-container">
    <!-- Hidden inputs for game data -->
    <input type="hidden" id="game-id" value="{{ game_id }}">
    <input type="hidden" id="player-name" value="{{ player_name }}">
    <input type="hidden" id="transfer-id" value="{{ transfer_id }}">
    <input type="hidden" id="is-host" value="{{ 'true' if is_host else 'false' }}">

    <div class="game-board">
        <div class="status-bar">
            <div class="turn-indicator">
                <i class="fas fa-user-circle"></i>
                ุงูุฏูุฑ ุนูู: <span id="current-turn">...</span>
            </div>
            <div id="timer" class="timer-container u-hidden">
                <svg class="timer-svg" viewBox="0 0 100 100">
                    <circle class="timer-bg" cx="50" cy="50" r="45"></circle>
                    <circle class="timer-progress" cx="50" cy="50" r="45"></circle>
                </svg>
                <span class="timer-text">0:00</span>
            </div>
        </div>

        <div class="display-area card">
            <!-- Pause Overlay -->
            <div id="pause-overlay" class="u-hidden u-full-width u-flex-center" style="position: absolute; inset: 0; background: rgba(255,255,255,0.9); z-index: 100; flex-direction: column; border-radius: inherit;">
                <i class="fas fa-pause-circle fa-5x animate-heartbeat" style="color: var(--primary); margin-bottom: 1.5rem;"></i>
                <h2 style="color: var(--text);">ุงููุนุจุฉ ูุชูููุฉ ูุคูุชุงู</h2>
                <p style="color: var(--text-light); font-weight: 700;">ุงููุถูู ุฃููู ุงููุนุจุฉุ ุงุณุชุฑุงุญุฉ ูุตูุฑุฉ!</p>
            </div>

            <div id="item-display" class="item-card animate-jelly u-hidden u-full-width">
                <!-- Content populated by JS -->
            </div>

            <!-- Pictionary Canvas -->
            <div id="pictionary-area" class="u-hidden u-full-width" style="position: relative;">
                <div class="canvas-controls u-flex-center u-margin-bottom">
                    <button class="btn btn-outline" onclick="window.gameInstance.clearCanvas()" id="clear-btn" style="padding: 0.8rem 1.2rem;"><i class="fas fa-eraser"></i> ูุณุญ</button>
                    <input type="color" id="draw-color" value="#FF6B6B" style="width: 50px; height: 50px; border: 3px solid var(--text); border-radius: 15px; cursor: pointer; padding: 0;">
                    <input type="range" id="draw-size" min="1" max="20" value="5" class="input-control" style="width: 120px; min-height: auto; padding: 0.5rem;">
                </div>
                <canvas id="game-canvas" width="600" height="400" style="border: 4px solid var(--text); border-radius: 20px 60px; background: white; cursor: crosshair; width: 100%; height: auto; touch-action: none; box-shadow: var(--shadow-pop);"></canvas>
            </div>

            <div id="waiting-area" class="waiting-area u-text-center">
                <i class="fas fa-hourglass-start fa-3x animate-heartbeat" style="color: var(--secondary); margin-bottom: 2rem;"></i>
                <h3>ูู ุงูุชุธุงุฑ ุจุฏุก ุงูุฌููุฉ...</h3>
            </div>

            <div class="game-actions u-flex-center u-full-width u-margin-top">
                <button id="readyButton" class="btn btn-primary u-hidden">
                <i class="fas fa-play"></i> ุฃูุง ุฌุงูุฒ! <kbd>Space</kbd>
                </button>
                <button id="passButton" class="btn btn-outline u-hidden">
                    <i class="fas fa-forward"></i> ุชุฎุทู
                </button>
                <button id="guessButton" class="btn btn-secondary u-hidden">
                <i class="fas fa-check"></i> ุนุฑูุชูุง! <kbd>Enter</kbd>
                </button>
            </div>
        </div>

        <div class="host-controls card u-flex-center" style="padding: 1.5rem;">
            {% if player_type == 'host' %}
            <button id="startButton" class="btn btn-primary" style="display: none;">
                <i class="fas fa-play-circle"></i> ุงุจุฏุฃ ุงููุนุจุฉ
            </button>
            <button id="nextButton" class="btn btn-secondary" style="display: none;">
                <i class="fas fa-step-forward"></i> ุงูุฌููุฉ ุงูุชุงููุฉ
            </button>
            <button id="pauseButton" class="btn btn-outline">
                <i class="fas fa-pause"></i> <span id="pause-btn-text">ุฅููุงู ูุคูุช</span> <kbd>P</kbd>
            </button>
            <button id="close-room" class="btn btn-outline" style="color: white; background-color: var(--danger);">
                <i class="fas fa-times-circle"></i> ุฅููุงุก ุงููุนุจุฉ
            </button>
            {% else %}
            <button id="leaveButton" class="btn btn-outline">
                <i class="fas fa-sign-out-alt"></i> ุงูุณุญุงุจ
            </button>
            {% endif %}
        </div>
    </div>

    <div class="sidebar">
        <div class="card player-list-card">
            <h4><i class="fas fa-users"></i> ุงููุงุนุจูู</h4>
            <div id="players-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="card score-card">
            <h4><i class="fas fa-trophy"></i> ุงููุชุงุฆุฌ</h4>
            <div id="scores">
                <!-- Populated by JS -->
            </div>
        </div>

        <div class="card info-card" style="padding: 1.2rem; font-size: 0.9rem; color: var(--text-light); text-align: center;">
            <p>ุฑูู ุงูุบุฑูุฉ:
                <strong id="game-room-id" style="color: var(--primary);">{{ game_id }}</strong>
                <button class="btn-copy" onclick="Utils.copyToClipboard('{{ game_id }}')" title="ูุณุฎ ุฑูู ุงูุบุฑูุฉ">
                    <i class="fas fa-copy"></i>
                </button>
            </p>
            <p>ุฃูุช ุชูุนุจ ุจุตูุชู: <strong style="color: var(--secondary);">{{ player_name }}</strong></p>
            <button id="show-rules-btn" class="btn btn-outline u-full-width u-margin-top" onclick="Utils.showRulesModal('{{ game_type }}')">
                <i class="fas fa-question-circle"></i> ุฅุฒุงู ุชูุนุจุ <kbd>H</kbd>
            </button>
        </div>
    </div>

    <div class="reaction-bar animate-bounce-down">
        <button onclick="window.gameInstance.sendReaction('๐')">๐</button>
        <button onclick="window.gameInstance.sendReaction('๐')">๐</button>
        <button onclick="window.gameInstance.sendReaction('๐ฅ')">๐ฅ</button>
        <button onclick="window.gameInstance.sendReaction('โค๏ธ')">โค๏ธ</button>
        <button onclick="window.gameInstance.sendReaction('๐ฎ')">๐ฎ</button>
    </div>
</div>

<!-- Game Summary Modal -->
<div id="summary-modal" class="modal">
    <div class="modal-content animate-jelly summary-content" style="max-width: 600px;">
        <h2 style="color: var(--primary);">๐ ุงูุชูุช ุงููุนุจุฉ!</h2>
        <div id="summary-leaderboard" class="u-margin-bottom"></div>

        <div id="summary-highlights" class="highlights-grid u-margin-bottom"></div>

        <div class="summary-stats card u-margin-bottom" style="padding: 1rem;">
            <div style="display: flex; justify-content: space-around; text-align: center;">
                <div>
                    <h4 id="stat-rounds">-</h4>
                    <p style="font-size: 0.8rem;">ุฌููุฉ</p>
                </div>
                <div>
                    <h4 id="stat-duration">-</h4>
                    <p style="font-size: 0.8rem;">ูุฏุฉ ุงููุนุจ</p>
                </div>
            </div>
        </div>

        <div class="buttons u-full-width">
            <button class="btn btn-primary" onclick="location.href='/'" style="flex: 1;">ุงูุฑุฆูุณูุฉ</button>
            <button class="btn btn-secondary" id="share-results-btn" style="flex: 1;">
                <i class="fas fa-share-alt"></i> ุดุงุฑู ุงููุชูุฌุฉ
            </button>
        </div>
    </div>
</div>

<div id="error-message"></div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/charades.js') }}"></script>
{% endblock %}
